# Отчет о тестировании платформы для рабочих

## Дата тестирования: 2025-12-02

### Роли для тестирования:
- client (Заказчик)
- foreman (Прораб)
- contractor (Подрядчик)
- worker (Рабочий)
- storekeeper (Складчик)
- technadzor (ТехНадзор)

---

## 1. ТЕСТИРОВАНИЕ ЗАДАЧ

### 1.1 Создание обычной задачи
**Роли:** foreman, contractor, technadzor

**Проверка:**
- [x] Задача создается с корректными данными
- [x] Задача сохраняется в базу данных (Supabase)
- [x] Задача появляется в канбан-доске
- [x] Задача появляется в списке задач
- [x] Статус по умолчанию: 'pending'
- [x] Прогресс по умолчанию: 0
- [x] Порядок (order) устанавливается корректно

**Код проверки:**
- Функция: `handleCreateTask` в `ScheduleViewWithAPI.tsx`
- API: `createTask` в `tasksApi.ts`
- Статус по умолчанию: `status: 'pending'` (строка 785)
- Прогресс: `progress: 0` (строка 763)

**Найденные проблемы:**
- ✅ **ИСПРАВЛЕНО**: Поле `order` не сохранялось в БД при создании задачи. Добавлено сохранение `order` в `tasksApi.ts` (строка 223-225)

### 1.2 Создание задачи от заказчика
**Роли:** client

**Проверка:**
- [ ] Задача создается с корректными данными
- [ ] Задача сохраняется в базу данных
- [ ] Задача появляется в канбан-доске
- [ ] Задача помечается как созданная заказчиком (clientCreatedTasks)
- [ ] Задача видна подрядчику

**Код проверки:**
- Функция: `handleCreateClientTask` в `ScheduleViewWithAPI.tsx` (строка 818)
- Отметка: `setClientCreatedTasks` (строка 840)

**Найденные проблемы:**
- 

### 1.3 Перетаскивание задач в канбане
**Проверка:**
- [ ] Задача перетаскивается между колонками
- [ ] Статус обновляется в базе данных
- [ ] Порядок (order) обновляется корректно
- [ ] Задача появляется в правильной колонке после перетаскивания

**Код проверки:**
- Функция: `handleDragEnd` в `ScheduleViewWithAPI.tsx` (строка 332)
- Обновление статуса: `handleUpdateTaskStatus` (строка 896)
- Обновление порядка: `handleUpdateTaskOrder` (строка 920)

**Найденные проблемы:**
- 

### 1.4 Фильтрация задач по ролям
**Проверка:**
- [ ] Рабочий (worker) видит только назначенные ему задачи
- [ ] Прораб (foreman) видит все задачи
- [ ] Подрядчик (contractor) видит все задачи
- [ ] Заказчик (client) видит задачи, которые он создал
- [ ] ТехНадзор (technadzor) видит все задачи

**Код проверки:**
- Функция: `filteredTasks` в `ScheduleViewWithAPI.tsx` (строка 738)

**Найденные проблемы:**
- 

---

## 2. ТЕСТИРОВАНИЕ ДЕФЕКТОВ

### 2.1 Создание дефекта
**Роли:** client, foreman, contractor, technadzor

**Проверка:**
- [x] Дефект создается с корректными данными
- [x] Дефект сохраняется в базу данных
- [x] Дефект появляется в списке дефектов
- [x] Фотографии загружаются корректно
- [x] Дефект связан с квартирой (если указана)

**Код проверки:**
- Функция: `handleCreateDefect` в `DefectsView.tsx` (строка 451)

**Найденные проблемы:**
- ✅ **ИСПРАВЛЕНО**: Дефекты создавались только локально, не сохранялись в Supabase. Добавлен вызов `createDefect` из `hybridDefectsApi` для сохранения в БД (строка 470)

### 2.2 Фильтрация дефектов по ролям
**Проверка:**
- [ ] Заказчик видит только созданные им дефекты
- [ ] Прораб видит назначенные ему дефекты и переданные рабочим
- [ ] Рабочий видит только переданные ему дефекты
- [ ] Подрядчик видит все дефекты, кроме переданных рабочим
- [ ] ТехНадзор видит все дефекты

**Код проверки:**
- Фильтрация в `DefectsView.tsx` (строка 1199)

**Найденные проблемы:**
- 

---

## 3. ТЕСТИРОВАНИЕ ОТЧЕТОВ

### 3.1 Создание отчета
**Роли:** worker, storekeeper, technadzor, foreman

**Проверка:**
- [ ] Отчет создается с корректными данными
- [ ] Отчет сохраняется в базу данных
- [ ] Отчет появляется в списке отчетов
- [ ] Фотографии загружаются корректно
- [ ] Тип отчета определяется корректно

**Код проверки:**
- Функция: `handleCreateReport` в `ReportsViewWithAPI.tsx`

**Найденные проблемы:**
- 

### 3.2 Фильтрация отчетов по ролям
**Проверка:**
- [ ] Складские отчеты видны только складчику и подрядчику
- [ ] Отчеты технадзора видны только технадзору и подрядчикам
- [ ] Отчеты подрядчика видны только подрядчику и заказчику
- [ ] Отчеты прораба видны только прорабу и подрядчику
- [ ] Отчеты рабочих видны только рабочим и прорабу

**Код проверки:**
- Фильтрация в `ReportsViewWithAPI.tsx` (строка 387)

**Найденные проблемы:**
- 

---

## 4. ТЕСТИРОВАНИЕ ЖУРНАЛА РАБОТ

### 4.1 Добавление записи в журнал
**Роли:** worker, foreman

**Проверка:**
- [ ] Запись создается с корректными данными
- [ ] Запись сохраняется в базу данных
- [ ] Запись появляется в журнале работ
- [ ] Прогресс обновляется корректно
- [ ] Связь с задачей работает

**Код проверки:**
- Компонент: `AddWorkJournalEntry.tsx`
- Функция: `handleSubmit` (строка 66)

**Найденные проблемы:**
- 

---

## 5. ТЕСТИРОВАНИЕ МАТЕРИАЛОВ

### 5.1 Создание/редактирование материалов
**Роли:** storekeeper, contractor

**Проверка:**
- [ ] Материал создается с корректными данными
- [ ] Материал сохраняется в базу данных
- [ ] Материал появляется в списке материалов
- [ ] Редактирование работает корректно
- [ ] Количество обновляется корректно

**Код проверки:**
- Компонент: `MaterialsViewWithAPI.tsx`

**Найденные проблемы:**
- 

---

## 6. ТЕСТИРОВАНИЕ ПРОЕКТОВ

### 6.1 Создание/редактирование проектов
**Роли:** client, contractor

**Проверка:**
- [ ] Проект создается с корректными данными
- [ ] Проект сохраняется в базу данных
- [ ] Проект появляется в списке проектов
- [ ] Редактирование работает корректно
- [ ] Связь с задачами работает

**Код проверки:**
- Компонент: `ProjectsViewWithAPI.tsx`

**Найденные проблемы:**
- 

---

## 7. ПРОВЕРКА СВЯЗЕЙ МЕЖДУ СУЩНОСТЯМИ

### 7.1 Задача → Проект
**Проверка:**
- [ ] Задача привязана к проекту (project_id)
- [ ] При создании задачи проект обязателен
- [ ] При удалении проекта задачи не удаляются (или удаляются?)

**Найденные проблемы:**
- 

### 7.2 Дефект → Квартира
**Проверка:**
- [ ] Дефект может быть привязан к квартире (apartment_id)
- [ ] Дефект может быть отмечен на плане (planMark)
- [ ] Координаты на плане сохраняются

**Найденные проблемы:**
- 

---

## 8. ОБЩИЕ ПРОБЛЕМЫ И РЕКОМЕНДАЦИИ

### Критические проблемы:
- 

### Важные проблемы:
- 

### Улучшения:
- 

---

## ИТОГОВЫЙ ОТЧЕТ О ЛОГИКЕ И ПРАВАХ ДОСТУПА

### Кто что видит:
- 

### Кто что может создавать:
- 

### Кто что может редактировать:
- 

### Кто что может удалять:
- 

