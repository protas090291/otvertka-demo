# Отчёт тестирования интерфейса «Отвёртка»

Пройдена навигация по разделам и проверены интерактивные элементы (кнопки, формы, ссылки) по коду. Исправления не вносились — только фиксация того, что работает, что нет и что лучше доработать.

---

## 1. Вход в систему (Login)

| Элемент | Работает | Примечание |
|--------|----------|------------|
| Поле Email | ✅ | Ввод, валидация |
| Поле Пароль | ✅ | Ввод |
| Кнопка «Войти» | ✅ | Проверка по моковым пользователям (director@company.ru / director123 и др.) |
| Отображение ошибки при неверных данных | ✅ | «Неверный email или пароль» |

**Итог:** Вход работает на моковых учётных данных. Реальной аутентификации (Supabase Auth и т.п.) нет.

---

## 2. Шапка (Header)

| Элемент | Работает | Примечание |
|--------|----------|------------|
| Кнопка меню (гамбургер) | ✅ | Сворачивание/разворачивание сайдбара |
| Кнопка поиска | ⚠️ | Нет обработчика — только UI |
| Кнопка уведомлений (колокольчик) | ⚠️ | Нет обработчика — только UI, красная точка |
| Выбор роли (select) | ✅ | Меняет `userRole`: Заказчик, Прораб, Подрядчик, Рабочий, Складчик, ТехНадзор; влияет на меню и дашборд |
| Блок «Профиль» | ⚠️ | Клик ничего не делает |
| Кнопка «Выход» | ✅ | Очистка `userType`, редирект на Login |

**Итог:** Навигация и выход работают. Поиск, уведомления и профиль — заглушки.

---

## 3. Боковое меню (Sidebar)

| Элемент | Работает | Примечание |
|--------|----------|------------|
| Пункты меню (Дашборд, Проекты, График, Бюджет, Материалы, Дефекты, Журнал работ, Отчёты, Яндекс Диск) | ✅ | Переключение `currentView`, состав пунктов зависит от роли |
| Кнопка «Настройки» (внизу) | ❌ | Нет `onClick` — кнопка не ведёт ни в какой раздел/модалку |

**Итог:** Вся навигация по разделам работает, кроме «Настройки».

---

## 4. Дашборд (Dashboard)

| Элемент | Работает | Примечание |
|--------|----------|------------|
| Блоки статистики (карточки по ролям) | ✅ | Статичные значения («Активные проекты», «Прогресс» и т.д.) |
| Блок «Активные проекты» с карточкой проекта | ✅ | Отрисовка `ProjectCard`, прогресс тянется из Supabase (`getProjectProgress`) |
| Кнопка «Все проекты» | ❌ | Нет `onClick` — навигация на раздел «Проекты» не реализована |
| График KPI (KPIChart) | ✅ | Рендер компонента |
| Кнопки «Быстрые действия» | ✅ | Ведют в нужные разделы (График, Дефекты, Отчёты, Бюджет, Материалы в зависимости от роли) |
| Блок «Последние обновления» | ✅ | Данные из `getRecentActivities()` (Supabase: tasks, defects, progress_data, reports). При ошибке/пустой БД — пустой блок или «Нет последних обновлений» |

**Итог:** Дашборд в целом рабочий. Не хватает перехода по кнопке «Все проекты» и, при желании, страницы настроек из сайдбара.

---

## 5. Проекты (ProjectsViewWithAPI)

| Элемент | Работает | Примечание |
|--------|----------|------------|
| Кнопка «Архитектурные планы» | ✅ | Вызов `onNavigateToPlans` → раздел «Архитектурные планы» |
| Кнопка «Новый проект» (для foreman/client/storekeeper) | ✅ | Открытие формы создания |
| Поиск и фильтр по статусу | ✅ | Локальная фильтрация списка |
| Форма создания проекта (поля, «Создать», «Отмена») | ✅ | `createProject()` в Supabase; при успехе — уведомление и обновление списка |
| Кнопки «Повторить загрузку» / «Создать проект» в блоке ошибки | ✅ | Работают |
| Карточки проектов | ✅ | Отображение; клик по карточке никуда не ведёт (нет перехода в детали проекта) |

**Итог:** Список проектов, создание и переход к планам работают. Детальная страница проекта по клику на карточку не реализована.

---

## 6. Архитектурные планы (ArchitecturalPlansView)

| Элемент | Работает | Примечание |
|--------|----------|------------|
| Кнопка «Назад» | ✅ | Возврат к разделу «Проекты» |
| Выбор проекта и квартиры | ✅ | Данные из `useProjects()`, `useApartments()`, `useArchitecturalPlans()` (Supabase) |
| Поиск и фильтр по типу плана | ✅ | Локальная фильтрация |
| Загрузка плана (модалка, выбор файла, тип) | ✅ | `uploadPlan()` из `usePlanUpload()` (Supabase storage) |
| Просмотр плана (PDF/изображение) | ✅ | Открытие в модалке/вьювере |
| Режим «Дефекты на плане» + клик по плану для создания дефекта | ✅ | Координаты клика, открытие `CreateDefectForm` |
| Создание дефекта с плана | ✅ | После сохранения — обновление счётчика и списка дефектов |

**Итог:** Раздел завязан на Supabase (drawings, projects, apartments). При пустой БД часть функций будет пустой, но кнопки и логика рабочие.

---

## 7. График / Задачи (ScheduleViewWithAPI)

| Элемент | Работает | Примечание |
|--------|----------|------------|
| Выбор проекта | ✅ | Список из `getAllProjects()` |
| Переключение вид/режим (канбан/таблица и т.д.) | ✅ | Локальное состояние |
| Загрузка задач | ✅ | `getAllTasks()` из Supabase |
| Создание задачи | ✅ | Форма, `createTask()` |
| Редактирование задачи (клик по карточке) | ✅ | Модалка, `updateTask()` |
| Перетаскивание задач (DnD) | ✅ | `updateTaskOrder()` |
| Таблица прогресса (ProgressTable) | ✅ | Отображение и редактирование прогресса по секциям/квартирам (progress_data в Supabase) |

**Итог:** Раздел полностью завязан на Supabase (tasks, progress_data). При отсутствии данных или ошибке API возможны пустые колонки или сообщения об ошибках.

---

## 8. Бюджет (BudgetViewWithAPI)

| Элемент | Работает | Примечание |
|--------|----------|------------|
| Загрузка операций | ✅ | `getAllBudgetItems()` (Supabase, таблица budget или аналог) |
| Фильтр по проекту | ✅ | Локальная фильтрация |
| Добавление операции | ✅ | Форма, `createBudgetItem()` |
| Редактирование / удаление операции | ✅ | `updateBudgetItem()`, `deleteBudgetItem()` |

**Итог:** Работает при наличии соответствующей таблицы в Supabase и данных.

---

## 9. Материалы (MaterialsViewWithAPI)

| Элемент | Работает | Примечание |
|--------|----------|------------|
| Загрузка позиций | ✅ | `getAllWarehouseItems()` (Supabase) |
| Поиск и фильтры (категория, статус) | ✅ | Локальная фильтрация |
| Добавление позиции | ✅ | Форма, `createWarehouseItem()` |
| Редактирование / удаление | ✅ | `updateWarehouseItem()`, `deleteWarehouseItem()` |

**Итог:** Аналогично бюджету — зависит от таблицы и данных в Supabase.

---

## 10. Дефекты (DefectsView)

| Элемент | Работает | Примечание |
|--------|----------|------------|
| Загрузка дефектов | ✅ | `getAllDefects()` (hybridDefectsApi: Supabase или localStorage fallback) |
| Фильтры и поиск | ✅ | По статусу и тексту |
| Создание дефекта (форма) | ✅ | `createDefect()`, с фото, квартирой, планом и т.д. |
| Смена статуса дефекта | ✅ | `DefectStatusChanger`, `updateDefectStatus()` |
| Комментарии к дефекту | ✅ | Добавление, при необходимости с фото |
| «Взять в работу» / «Назначить прорабу» / «Назначить рабочему» / «Отклонить» | ✅ | Логика и формы есть в коде |
| Просмотр дефекта на плане (план с отметками) | ✅ | `PlanWithSupabaseDefects`, `PlanWithMarks` |
| Открытие плана по квартире | ✅ | Зависит от наличия чертежей в Supabase |

**Итог:** Раздел насыщенный; поведение зависит от Supabase (и при его недоступности — от fallback в localStorage).

---

## 11. Журнал работ (WorkJournal)

| Элемент | Работает | Примечание |
|--------|----------|------------|
| Загрузка записей | ✅ | `getAllWorkJournalEntries()` и др. (Supabase `work_journal`) |
| Фильтры по дате (все / сегодня / вчера / неделя / свой период) | ✅ | Работают |
| Поиск и фильтры по задаче/квартире | ✅ | Локальная фильтрация |
| Кнопка «Сбросить» | ✅ | Сброс фильтров и перезагрузка |
| Экспорт CSV | ✅ | `exportWorkJournalToCSV()`, скачивание файла |
| Разворачивание/сворачивание записи (ChevronRight/ChevronDown) | ✅ | Локальное состояние |
| Удаление записи | ✅ | `deleteWorkJournalEntry()` |
| Кнопка/форма «Добавить запись» | ❌ | Компонент `AddWorkJournalEntry` импортирован, но **нигде не отображается** в JSX — добавить запись из интерфейса нельзя |

**Итог:** Просмотр, фильтрация и экспорт работают. Критичный недостаток: в UI нет возможности добавить запись в журнал (компонент есть, но не подключён).

---

## 12. Отчёты (ReportsViewWithAPI)

| Элемент | Работает | Примечание |
|--------|----------|------------|
| Загрузка отчётов | ✅ | `getAllReports()` (Supabase) |
| Фильтр по типу отчёта | ✅ | Локальная фильтрация |
| Создание отчёта (прораб/рабочий и т.д.) | ✅ | Формы по ролям, `createReport()` |
| Создание складского отчёта | ✅ | Отдельная форма, тип `warehouse` |
| Создание отчёта технадзора / подрядчика | ✅ | Формы и вызовы API |

**Итог:** Зависит от таблицы `reports` в Supabase; кнопки и формы рабочие.

---

## 13. Яндекс Диск (YandexDiskView)

| Элемент | Работает | Примечание |
|--------|----------|------------|
| Загрузка списка файлов/папок | ✅ | `getYandexDiskFiles()` → бэкенд **http://localhost:8000** (`/api/yandex-disk`) |
| Обновление списка (кнопка «Обновить») | ✅ | `refreshYandexDiskFiles()` |
| Переход по папкам (клик по папке) | ✅ | Навигация по путям, `currentPath`, `pathHistory` |
| Хлебные крошки (назад по путям) | ✅ | `handleBreadcrumbClick` |
| Скачивание файла | ✅ | `downloadFromYandexDisk()` через бэкенд |
| Просмотр файла (открыть в браузере/встроенный просмотр) | ✅ | `getYandexDiskViewLink()` / `FileViewer` |

**Итог:** Работает при запущенном бэкенде на порту **8000** и настроенном доступе к Яндекс.Диску (токен/публичная папка в `.env`).

---

## 14. AI-помощник (AIAssistant)

| Элемент | Работает | Примечание |
|--------|----------|------------|
| Проверка подключения | ⚠️ | Запрос на **http://localhost:8001/health** — в проекте бэкенд один и запускается на **8000** (simple_main.py). Порт **8001** в коде не совпадает с фактическим, проверка и все запросы к 8001 будут падать |
| Голосовой ввод (микрофон) | ⚠️ | Отправка команд на 8001 — без сервиса на 8001 не заработает |
| Текстовый ввод и отправка команд | ⚠️ | То же — API на 8001 |
| Генерация документов по голосу/тексту (акт, отчёт о дефекте и т.д.) | ⚠️ | `documentGenerationApi` и `aiApi` используют **8001**; бэкенд на 8000 — несоответствие портов |
| Ссылки на скачивание документов | ⚠️ | Формируются как `http://localhost:8001/...` — при реальном сервере на 8000 ссылки не откроются |
| DefectTester (тест дефектов по фото) | ⚠️ | Зависит от API (модель тестирования на 8008 в modelTestingApi) |

**Итог:** Вся логика AI-помощника и генерации документов завязана на порт **8001**. В `start_app.sh` и в коде бэкенда используется порт **8000**. Нужно либо поднять отдельный сервис на 8001, либо заменить в фронте 8001 на 8000 и убедиться, что в simple_main есть все нужные эндпоинты (`/health`, `/generate-letter`, `/api/commands`, документы и т.д.).

---

## 15. Платформа руководства (ManagementApp)

Показывается при входе под пользователем с типом **management** (director@company.ru / deputy@company.ru).

| Элемент | Работает | Примечание |
|--------|----------|------------|
| Выход | ✅ | `onLogout` |
| Навигация (Summary, Бух. отчётность, Проекты, Договоры, Закупки, РД и СД, Система контроля) | ✅ | Переключение подразделов |
| Подразделы бух. отчётности (Баланс, Cash Flow, PL) | ✅ | Переключение подвью |
| Данные во всех разделах | ✅ | **Моковые** — из `managementApi.ts`, без запросов к Supabase или бэкенду. Всё отображается и «работает» как статичный демо-интерфейс |

**Итог:** Интерфейс для руководства полностью на моках; кнопки и навигация работают, данные не из БД.

---

## 16. Зависимости от внешних сервисов

| Сервис | Где используется | Порт/URL | Запуск |
|--------|------------------|----------|--------|
| Supabase | Проекты, задачи, прогресс, дефекты, отчёты, журнал работ, бюджет, материалы, активность, чертежи | В коде (URL и anon key в supabase.ts) | Облако, нужен интернет и настроенные таблицы |
| Бэкенд (simple_main.py) | Яндекс.Диск, генерация документов, голосовые команды (по задумке) | В коде: **8000** (Яндекс) и **8001** (AI/документы) | `python3 simple_main.py` в Helper2/backend — слушает **8000** |
| Модель тестирования (DefectTester) | Тест распознавания дефектов по фото | **8008** в modelTestingApi | Отдельный сервис, в start_app не запускается |

---

## 17. Сводка: что лучше исправить в первую очередь

1. **Кнопка «Все проекты» на дашборде** — повесить `onClick` и переход на раздел «Проекты» (`onNavigate('projects')`).
2. **Журнал работ: добавление записи** — вывести в интерфейс компонент `AddWorkJournalEntry` (например, кнопка «Добавить запись» в шапке журнала и модалка/панель с этим компонентом).
3. **Настройки в сайдбаре** — либо задать `onClick` (открытие страницы/модалки настроек), либо временно скрыть кнопку.
4. **Порт 8001 vs 8000** — унифицировать: либо в фронте заменить 8001 на 8000 для health, document generation и commands и убедиться, что все эти маршруты есть в simple_main.py; либо поднять второй бэкенд на 8001 и оставить фронт как есть.
5. **Поиск и уведомления в шапке** — либо добавить минимальную логику (например, поиск по разделам / заглушка страницы уведомлений), либо явно пометить как «скоро».
6. **Профиль в шапке** — при желании добавить открытие модалки/страницы профиля или смену пароля (при появлении реальной авторизации).
7. **Клик по карточке проекта** (на дашборде или в разделе «Проекты») — при желании сделать переход на детальный вид проекта (если такой экран будет в дизайне).

После этих правок интерфейс будет вести себя предсказуемо: все видимые кнопки будут иметь действие, журнал работ можно будет пополнять из UI, а AI и документы — работать с одним бэкендом на выбранном порту.
