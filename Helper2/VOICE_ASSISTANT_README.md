# Голосовой помощник для строительного приложения

## Описание проекта

Это комплексная система голосового помощника для строительного приложения "Отвёртка", которая позволяет создавать документы и отправлять их на печать через голосовые команды с мобильного устройства.

## Архитектура системы

```
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│   Мобильное     │    │   Backend API   │    │  Офисный агент  │
│   приложение    │───▶│   (FastAPI)     │◀───│   (Python)      │
│  (React Native) │    │                 │    │                 │
└─────────────────┘    └─────────────────┘    └─────────────────┘
         │                       │                       │
         │                       │                       │
         ▼                       ▼                       ▼
┌─────────────────┐    ┌─────────────────┐    ┌─────────────────┐
│  Голосовое      │    │   Supabase      │    │   Принтер       │
│  распознавание  │    │   Database      │    │   (локальный)   │
└─────────────────┘    └─────────────────┘    └─────────────────┘
```

## Компоненты системы

### 1. Мобильное приложение (React Native)
- **Функции**: Принимает голосовые команды, распознает речь, отправляет команды в backend
- **Технологии**: React Native, Expo, Expo AV, Expo Speech
- **Команды**: 
  - "Создай акт приёмки для квартиры 1101"
  - "Распечатай акт для квартиры 1205"
  - "Создай дефект в квартире 1103 трещина в стене"
  - "Распечатай отчет о дефектах для квартиры 1101"

### 2. Backend API (FastAPI)
- **Функции**: Обрабатывает команды, предоставляет API для агента, управляет статусами
- **Технологии**: FastAPI, Supabase, Python
- **Endpoints**:
  - `POST /api/commands` - создание команды
  - `GET /api/commands/pending` - получение pending команд
  - `PATCH /api/commands/{id}` - обновление статуса команды
  - `GET /api/commands/{id}/status` - проверка статуса команды

### 3. Офисный агент (Python)
- **Функции**: Обрабатывает команды, генерирует документы, отправляет на печать
- **Технологии**: Python, python-docx, Supabase, win32print (Windows)
- **Возможности**:
  - Создание актов приёмки
  - Создание отчётов о дефектах
  - Автоматическая печать документов
  - Загрузка документов в Supabase Storage

### 4. База данных (Supabase)
- **Таблицы**:
  - `commands` - команды от мобильного приложения
  - `documents` - сгенерированные документы
  - `agent_logs` - логи работы агента
- **Storage**: Хранение сгенерированных документов

## Быстрый старт

### 1. Настройка Supabase
```bash
# Выполните SQL скрипт в Supabase Dashboard
supabase-voice-assistant-setup.sql
```

### 2. Запуск Backend
```bash
cd backend
pip install -r requirements.txt
cp ../env.example .env
# Отредактируйте .env файл
python main.py
```

### 3. Запуск агента
```bash
cd office-agent
pip install -r requirements.txt
cp ../env.example .env
# Отредактируйте .env файл
python agent.py
```

### 4. Запуск мобильного приложения
```bash
cd mobile-app
npm install
# Отредактируйте конфигурацию в App.tsx
expo start
```

## Тестирование

### Тест API
```bash
cd test-scripts
python test_api.py
```

### Тест агента
```bash
cd test-scripts
python test_agent.py
```

## Структура проекта

```
voice-assistant/
├── backend/                 # FastAPI backend
│   ├── main.py             # Основной файл API
│   └── requirements.txt    # Python зависимости
├── office-agent/           # Python агент
│   ├── agent.py           # Основной файл агента
│   └── requirements.txt   # Python зависимости
├── mobile-app/            # React Native приложение
│   ├── App.tsx           # Основной компонент
│   └── package.json      # Node.js зависимости
├── test-scripts/         # Тестовые скрипты
│   ├── test_api.py      # Тесты API
│   └── test_agent.py    # Тесты агента
├── supabase-voice-assistant-setup.sql  # SQL скрипт для Supabase
├── env.example           # Пример переменных окружения
├── DEPLOYMENT_GUIDE.md   # Подробное руководство по развертыванию
└── VOICE_ASSISTANT_README.md  # Этот файл
```

## Безопасность

- **Service Role Key** используется только на сервере и агенте
- **Anon Key** используется в мобильном приложении
- Все ключи хранятся в переменных окружения
- CORS настроен для безопасного взаимодействия

## Мониторинг

### Логи агента
```bash
tail -f office-agent/agent.log
```

### Статус команд в Supabase
```sql
SELECT * FROM commands ORDER BY created_at DESC LIMIT 10;
```

### Логи агента в базе данных
```sql
SELECT * FROM agent_logs ORDER BY created_at DESC LIMIT 20;
```

## Расширение функциональности

### Добавление новых типов команд
1. Обновите `VALID_COMMAND_TYPES` в backend
2. Добавьте обработку в агенте
3. Обновите парсинг в мобильном приложении

### Интеграция с реальным распознаванием речи
- Google Speech-to-Text API
- Azure Speech Services
- Офлайн распознавание с Vosk

### Дополнительные типы документов
- Акт скрытых работ
- Протокол испытаний
- Справки и сертификаты

## Troubleshooting

### Агент не обрабатывает команды
- Проверьте подключение к Supabase
- Убедитесь, что Service Role Key правильный
- Проверьте логи агента

### Мобильное приложение не отправляет команды
- Проверьте URL backend в конфигурации
- Убедитесь, что backend запущен
- Проверьте CORS настройки

### Документы не печатаются
- Проверьте имя принтера
- Убедитесь, что принтер подключен и работает
- Проверьте права доступа к принтеру

## Лицензия

Этот проект создан для демонстрации возможностей голосового помощника в строительном приложении.

## Поддержка

Для получения поддержки или сообщения об ошибках, пожалуйста, обратитесь к разработчикам проекта.


